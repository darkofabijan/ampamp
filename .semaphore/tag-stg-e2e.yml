version: v1.0
name: Tag, Staging release, e2e
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu1804

blocks:
  - name: Bump tags
    task:
      jobs:
      - name: Tag
        commands:
          - checkout
          - echo "tag"

  - name: Deploy to staging env
    task:
      jobs:
      - name: Deploy
        commands:
          - echo "Deploy"

  - name: E2e tests & update dashboard
    task:
      jobs:
      - name: Deploy
        commands:
          - echo "Deploy"

promotions:
  - name: "[master] Red alert in Slack"
    pipeline_file: master-red-alert.yml
    auto_promote_on:
    - result: failed
      branch:
        - "^master$"

  - name: "[master] Tag, Beta release, e2e"
    pipeline_file: tag-beta-e2e.yml
    auto_promote_on:
    - result: passed
      branch:
        - "^master$"
